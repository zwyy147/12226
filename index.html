<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>梧桐文件提取工具 </title>
    <!-- 引入解析库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <style>
        :root {
            /* 白天模式 */
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --border-color: #e5e7eb;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --danger: #ef4444;
            --danger-hover: #dc2626;
            --success: #10b981;
            --warning: #f59e0b; 
            --input-bg: #ffffff;
            --highlight-bg: #bfdbfe;
        }

        [data-theme="dark"] {
            /* 黑夜模式 */
            --bg-body: #111827;
            --bg-card: #1f2937;
            --text-main: #e5e7eb;
            --text-sub: #9ca3af;
            --border-color: #374151;
            --primary: #60a5fa;
            --primary-hover: #3b82f6;
            --danger: #f87171;
            --danger-hover: #ef4444;
            --success: #34d399;
            --warning: #fbbf24;
            --input-bg: #111827;
            --highlight-bg: #1e3a8a;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        /* 顶部栏 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .title-group {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        h1 {
            margin: 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .author-tag {
            font-size: 0.8rem;
            color: var(--text-sub);
            font-weight: normal;
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .icon {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* 控制区域 */
        .controls-container {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid var(--border-color);
        }

        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        /* 按钮通用 */
        .btn {
            padding: 8px 12px;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            font-weight: 500;
            background-color: var(--bg-body);
            color: var(--text-main);
            border-color: var(--border-color);
            user-select: none;
            flex-shrink: 0;
        }
        .btn:hover { filter: brightness(0.95); }
        .btn:active { transform: scale(0.98); }

        .btn-primary { background-color: var(--primary); color: white; border: none; }
        .btn-danger { background-color: var(--danger); color: white; border: none; }
        .btn-success { background-color: var(--success); color: white; border: none; }
        .btn-warning { background-color: var(--warning); color: white; border: none; }

        input[type="text"], select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-main);
            outline: none;
            font-size: 14px;
        }

        input[type="file"] {
            font-size: 13px;
            color: var(--text-sub);
        }

        /* 编辑器区域 */
        .editor-container {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        #outputArea {
            width: 100%;
            height: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            box-sizing: border-box;
            outline: none;
            background-color: var(--bg-card);
            color: var(--text-main);
            transition: border-color 0.2s;
        }
        
        #outputArea::selection {
            background-color: var(--highlight-bg);
            color: inherit;
        }

        #outputArea:focus {
            border-color: var(--primary);
        }

        /* 加载遮罩 */
        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 8px;
            z-index: 10;
        }

        /* 通用弹窗样式 (Modal & Toast) */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-box {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            color: var(--text-main);
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-title { font-weight: bold; margin-bottom: 10px; display: block; font-size: 16px; }
        .modal-message { margin: 15px 0; font-size: 14px; color: var(--text-sub); line-height: 1.5; }
        .modal-input { width: 90%; margin: 10px 0; padding: 8px; }
        
        .toast {
            position: fixed;
            top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white;
            padding: 10px 20px; border-radius: 20px; font-size: 14px;
            display: none; z-index: 2000;
        }

        /* 搜索框组 */
        .search-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
        }
        .search-input { width: 100px; flex-grow: 1; max-width: 200px; }
        .search-btn-group { display: flex; gap: 0; }
        .search-btn-group .btn { border-radius: 0; border-right: 1px solid var(--border-color); }
        .search-btn-group .btn:first-child { border-top-left-radius: 6px; border-bottom-left-radius: 6px; }
        .search-btn-group .btn:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px; border-right: none; }
        .search-status { font-size: 12px; color: var(--text-sub); margin-left: 5px; white-space: nowrap; }

    </style>
</head>
<body>

    <div class="header">
        <div class="title-group">
            <h1>
                <svg class="icon" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                文本提取器
            </h1>
            <span class="author-tag">by 梧桐 | 禁止二传/盈利</span>
        </div>
        
        <button id="themeToggle" class="btn" title="切换黑夜模式">
            <svg id="iconSun" class="icon" viewBox="0 0 24 24" style="display:none"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>
            <svg id="iconMoon" class="icon" viewBox="0 0 24 24"><path d="M10 2c-1.82 0-3.53.5-5 1.35C7.99 5.08 10 8.3 10 12s-2.01 6.92-5 8.65C6.47 21.5 8.18 22 10 22c5.52 0 10-4.48 10-10S15.52 2 10 2z"/></svg>
        </button>
    </div>

    <div class="controls-container">
        <!-- 上传 & 搜索 -->
        <div class="row">
            <input type="file" id="fileInput" accept=".txt,.json,.js,.css,.html,.md,.xml,.csv,.docx,.pdf,.xlsx,.xls">
            
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="搜索关键词...">
                <div class="search-btn-group">
                    <button id="prevMatchBtn" class="btn" title="上一个">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    </button>
                    <button id="searchBtn" class="btn" title="搜索/下一个">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                    </button>
                    <button id="nextMatchBtn" class="btn" title="下一个">
                        <svg class="icon" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                    </button>
                </div>
                <span id="searchStatus" class="search-status"></span>
            </div>
        </div>

        <!-- 功能按键 -->
        <div class="row">
            <button id="clearBtn" class="btn btn-danger">
                <svg class="icon" viewBox="0 0 24 24"><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg> 清除
            </button>
            <button id="copyBtn" class="btn btn-success">
                <svg class="icon" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg> 复制
            </button>
        </div>

        <!-- 预设 (IndexedDB版) -->
        <div class="row" style="background: rgba(0,0,0,0.03); padding: 8px; border-radius: 6px;">
            <select id="presetSelect" style="max-width: 150px;">
                <option value="">-- 选择预设 --</option>
            </select>
            <button id="savePresetBtn" class="btn btn-primary" title="另存为新预设">
                <svg class="icon" viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
                保存
            </button>
            <button id="updatePresetBtn" class="btn btn-warning" title="更新当前预设" style="color:white">
                <svg class="icon" viewBox="0 0 24 24"><path d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79 2.73 2.71 7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.51-3.47-3.51-9.11 0-12.58 3.51-3.47 9.14-3.47 12.65 0l3.65-3.72V10.12z"/></svg>
                更新
            </button>
            <button id="delPresetBtn" class="btn btn-danger" title="删除">
                <svg class="icon" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
            </button>
        </div>
    </div>

    <div class="editor-container">
        <!-- 核心技巧：inputmode="text" 是默认，搜索时会动态改为 "none" -->
        <textarea id="outputArea" inputmode="text" placeholder="内容显示区..."></textarea>
        <div id="loading" class="loading-overlay">
            <div style="text-align:center">
                <svg class="icon" style="width:40px;height:40px;animation:spin 1s linear infinite" viewBox="0 0 24 24"><path d="M12 4V2A10 10 0 0 0 2 12h2a8 8 0 0 1 8-8z"/></svg>
                <div style="margin-top:10px">处理中...</div>
            </div>
        </div>
    </div>

    <!-- 1. Toast 提示 -->
    <div id="toast" class="toast">提示信息</div>

    <!-- 2. 输入弹窗 (保存预设) -->
    <div id="promptModal" class="modal-overlay">
        <div class="modal-box">
            <span class="modal-title">保存预设</span>
            <input type="text" id="promptInput" class="modal-input" placeholder="输入预设名称">
            <div class="row" style="justify-content: center; margin-top: 10px;">
                <button id="promptCancel" class="btn">取消</button>
                <button id="promptConfirm" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <!-- 3. 确认弹窗 (更新/删除预设) -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-box">
            <span class="modal-title" id="confirmTitle">提示</span>
            <div id="confirmMessage" class="modal-message"></div>
            <div class="row" style="justify-content: center; margin-top: 10px;">
                <button id="confirmCancelBtn" class="btn">取消</button>
                <button id="confirmOkBtn" class="btn btn-primary">确定</button>
            </div>
        </div>
    </div>

    <style>@keyframes spin { 100% { transform: rotate(360deg); } }</style>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // --- DOM 元素 ---
        const UI = {
            fileInput: document.getElementById('fileInput'),
            output: document.getElementById('outputArea'),
            themeBtn: document.getElementById('themeToggle'),
            search: {
                input: document.getElementById('searchInput'),
                btn: document.getElementById('searchBtn'),
                prev: document.getElementById('prevMatchBtn'),
                next: document.getElementById('nextMatchBtn'),
                status: document.getElementById('searchStatus')
            },
            preset: {
                select: document.getElementById('presetSelect'),
                save: document.getElementById('savePresetBtn'),
                update: document.getElementById('updatePresetBtn'),
                del: document.getElementById('delPresetBtn')
            },
            loading: document.getElementById('loading'),
            toast: document.getElementById('toast'),
            modal: document.getElementById('promptModal'),
            confirm: document.getElementById('confirmModal') // 新增确认弹窗
        };

        // --- IndexedDB 存储模块 ---
        const DB_NAME = 'TextExtractorDB';
        const STORE_NAME = 'presets';
        let dbInstance = null;

        const DB = {
            init: () => {
                return new Promise((resolve, reject) => {
                    const req = indexedDB.open(DB_NAME, 1);
                    req.onupgradeneeded = (e) => {
                        const db = e.target.result;
                        if (!db.objectStoreNames.contains(STORE_NAME)) {
                            db.createObjectStore(STORE_NAME, { keyPath: 'name' });
                        }
                    };
                    req.onsuccess = (e) => {
                        dbInstance = e.target.result;
                        resolve(dbInstance);
                    };
                    req.onerror = (e) => reject(e);
                });
            },
            save: (name, content) => {
                return new Promise((resolve, reject) => {
                    const tx = dbInstance.transaction(STORE_NAME, 'readwrite');
                    const store = tx.objectStore(STORE_NAME);
                    const req = store.put({ name, content });
                    req.onsuccess = () => resolve();
                    req.onerror = (e) => reject(e);
                });
            },
            getAll: () => {
                return new Promise((resolve, reject) => {
                    const tx = dbInstance.transaction(STORE_NAME, 'readonly');
                    const store = tx.objectStore(STORE_NAME);
                    const req = store.getAll();
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = (e) => reject(e);
                });
            },
            delete: (name) => {
                return new Promise((resolve, reject) => {
                    const tx = dbInstance.transaction(STORE_NAME, 'readwrite');
                    const store = tx.objectStore(STORE_NAME);
                    const req = store.delete(name);
                    req.onsuccess = () => resolve();
                    req.onerror = (e) => reject(e);
                });
            }
        };

        // --- 初始化 ---
        window.onload = async () => {
            try {
                await DB.init();
                await refreshPresets();
            } catch (e) {
                console.error("DB Init Failed", e);
                showToast("数据库初始化失败");
            }
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                toggleTheme(true);
            }
        };

        // --- 1. 搜索核心逻辑 ---
        let searchState = { indices: [], currentIdx: -1, keyword: '' };

        function runSearch(direction = 0) {
            const keyword = UI.search.input.value;
            const content = UI.output.value;

            if (!keyword || !content) return;

            if (keyword !== searchState.keyword) {
                searchState.indices = [];
                let pos = content.indexOf(keyword);
                while (pos !== -1) {
                    searchState.indices.push(pos);
                    pos = content.indexOf(keyword, pos + 1);
                }
                searchState.keyword = keyword;
                searchState.currentIdx = -1;
            }

            if (searchState.indices.length === 0) {
                UI.search.status.textContent = "0/0";
                showToast("未找到内容");
                return;
            }

            if (direction === 0 && searchState.currentIdx === -1) direction = 1;
            
            let newIdx = searchState.currentIdx + direction;
            if (newIdx >= searchState.indices.length) newIdx = 0;
            if (newIdx < 0) newIdx = searchState.indices.length - 1;
            
            searchState.currentIdx = newIdx;
            highlightAndScroll(searchState.indices[newIdx], keyword.length);
        }

        function highlightAndScroll(start, length) {
            const el = UI.output;
            el.setAttribute('inputmode', 'none'); // 禁止键盘弹出
            el.focus();
            el.setSelectionRange(start, start + length);
            el.blur(); el.focus(); // 强制滚动
            UI.search.status.textContent = `${searchState.currentIdx + 1}/${searchState.indices.length}`;
        }

        UI.output.addEventListener('mousedown', () => enableKeyboard());
        UI.output.addEventListener('touchstart', () => enableKeyboard());

        function enableKeyboard() {
            if (UI.output.getAttribute('inputmode') === 'none') {
                UI.output.setAttribute('inputmode', 'text');
            }
        }

        UI.search.btn.addEventListener('click', () => runSearch(1));
        UI.search.next.addEventListener('click', () => runSearch(1));
        UI.search.prev.addEventListener('click', () => runSearch(-1));

        // --- 2. 预设功能 (UI优化版) ---
        async function refreshPresets() {
            const list = await DB.getAll();
            UI.preset.select.innerHTML = '<option value="">-- 选择预设 --</option>';
            list.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.name;
                opt.textContent = item.name;
                UI.preset.select.appendChild(opt);
            });
        }

        UI.preset.select.addEventListener('change', async (e) => {
            const name = e.target.value;
            if (!name) return;
            const list = await DB.getAll();
            const target = list.find(i => i.name === name);
            if (target) {
                UI.output.value = target.content;
                showToast(`已加载: ${name}`);
                searchState = { indices: [], currentIdx: -1, keyword: '' };
                UI.search.status.textContent = '';
            }
        });

        // 保存 - 使用 Prompt 弹窗
        UI.preset.save.addEventListener('click', () => {
            if (!UI.output.value) return showToast('内容为空');
            showPrompt('请输入新预设名称', async (name) => {
                await DB.save(name, UI.output.value);
                await refreshPresets();
                UI.preset.select.value = name;
                showToast('保存成功');
            });
        });

        // 更新 - 使用 Confirm 弹窗 (自定义)
        UI.preset.update.addEventListener('click', async () => {
            const currentName = UI.preset.select.value;
            if (!currentName) return showToast('请先选择预设');
            if (!UI.output.value) return showToast('内容为空');
            
            showConfirm('更新确认', `确定要覆盖更新预设 "${currentName}" 吗？此操作无法撤销。`, async () => {
                await DB.save(currentName, UI.output.value);
                showToast('预设已更新');
            });
        });

        // 删除 - 使用 Confirm 弹窗 (自定义)
        UI.preset.del.addEventListener('click', async () => {
            const name = UI.preset.select.value;
            if (!name) return showToast('未选择预设');
            
            showConfirm('删除确认', `确定要永久删除预设 "${name}" 吗？`, async () => {
                await DB.delete(name);
                await refreshPresets();
                UI.output.value = '';
                showToast('删除成功');
            });
        });

        // --- 3. 文件处理 ---
        UI.fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            showLoading(true);
            try {
                const text = await parseFile(file);
                UI.output.value = text;
                showToast(`导入成功: ${file.name}`);
            } catch (err) {
                showToast('解析失败: ' + err.message);
            } finally {
                showLoading(false);
                UI.fileInput.value = '';
            }
        });

        async function parseFile(file) {
            const ext = file.name.split('.').pop().toLowerCase();
            if (ext === 'docx') {
                const buff = await readFile(file, 'buffer');
                const res = await mammoth.extractRawText({ arrayBuffer: buff });
                return res.value;
            } else if (['xlsx','xls','csv'].includes(ext)) {
                const buff = await readFile(file, 'buffer');
                const wb = XLSX.read(buff, { type: 'array' });
                let str = '';
                wb.SheetNames.forEach(n => str += `--- ${n} ---\n` + XLSX.utils.sheet_to_csv(wb.Sheets[n]) + '\n\n');
                return str;
            } else if (ext === 'pdf') {
                const buff = await readFile(file, 'buffer');
                const pdf = await pdfjsLib.getDocument(buff).promise;
                let str = '';
                for(let i=1; i<=pdf.numPages; i++) {
                    const p = await pdf.getPage(i);
                    const c = await p.getTextContent();
                    str += c.items.map(i=>i.str).join(' ') + '\n\n';
                }
                return str;
            } else {
                return await readFile(file, 'text');
            }
        }

        function readFile(file, type) {
            return new Promise((r, j) => {
                const reader = new FileReader();
                reader.onload = e => r(e.target.result);
                reader.onerror = j;
                type === 'buffer' ? reader.readAsArrayBuffer(file) : reader.readAsText(file);
            });
        }

        // --- 4. 辅助函数 & 弹窗逻辑 ---
        let isDark = false;
        UI.themeBtn.addEventListener('click', () => toggleTheme());
        function toggleTheme(force) {
            isDark = force !== undefined ? force : !isDark;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            document.getElementById('iconSun').style.display = isDark ? 'block' : 'none';
            document.getElementById('iconMoon').style.display = isDark ? 'none' : 'block';
        }

        document.getElementById('clearBtn').addEventListener('click', () => { UI.output.value = ''; showToast('已清除'); });
        document.getElementById('copyBtn').addEventListener('click', async () => {
            if(!UI.output.value) return;
            await navigator.clipboard.writeText(UI.output.value);
            showToast('已复制');
        });

        function showLoading(s) { UI.loading.style.display = s ? 'flex' : 'none'; }
        function showToast(m) {
            UI.toast.textContent = m;
            UI.toast.style.display = 'block';
            setTimeout(() => UI.toast.style.display = 'none', 2000);
        }

        // 输入框弹窗 (Show Prompt)
        function showPrompt(title, cb) {
            document.querySelector('.modal-title').textContent = title;
            const inp = document.getElementById('promptInput');
            inp.value = '';
            UI.modal.style.display = 'flex';
            inp.focus();
            
            const confirmBtn = document.getElementById('promptConfirm');
            const cancelBtn = document.getElementById('promptCancel');

            // 简单覆盖 onclick，防止多次绑定
            confirmBtn.onclick = () => {
                if(inp.value.trim()) cb(inp.value.trim());
                UI.modal.style.display = 'none';
            };
            cancelBtn.onclick = () => UI.modal.style.display = 'none';
        }

        // 确认框弹窗 (Show Confirm) - 新增
        function showConfirm(title, message, onConfirm) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            
            const modal = UI.confirm;
            modal.style.display = 'flex';

            const okBtn = document.getElementById('confirmOkBtn');
            const cancelBtn = document.getElementById('confirmCancelBtn');

            okBtn.onclick = () => {
                modal.style.display = 'none';
                onConfirm();
            };
            cancelBtn.onclick = () => {
                modal.style.display = 'none';
            };
        }
    </script>
</body>
</html>